<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ñ–µ–∫–∞ –¢–≤–∏–Ω–∫</title>
<meta name="description" content="—Å–ø–∏—Å–æ–∫" />
<style>
/* ================== –°—Ç–∏–ª–∏ (cozy –¥–µ—Ä–µ–≤–Ω—è) ================== */
:root{
  --body-bg1:#efe7d2;
  --body-bg2:#f8f3ea;
  --wood:#8a6b4a;
  --accent:#7aa89a;
  --muted:#5f4f3f;
  --card-bg:#fffaf2;
  --coupon:#f3e6cc;
  --shadow: rgba(15,12,10,0.18);
  --maxw:1200px;
}

*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family: Inter, "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;color:var(--muted)}
body{
  background: linear-gradient(180deg,var(--body-bg1),var(--body-bg2));
  display:flex;
  justify-content:center;
  overflow-x:hidden;
}

/* —Ñ–æ–Ω-–∫–∞–Ω–≤–∞—Å-–ª–µ—Å (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–¥ –¥–µ—Ä–µ–≤—å—è) */
#forest-bg{
  position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:0;
  display:flex;justify-content:space-between;align-items:stretch;
}
#forest-bg canvas{ width:320px; height:100%; }

/* –≥–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
.container{
  width:100%;
  max-width:var(--maxw);
  margin:20px;
  padding:22px;
  background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.85));
  border-radius:14px;
  box-shadow: 0 10px 30px var(--shadow);
  position:relative;
  z-index:2;
}

/* header */
header{text-align:center;margin-bottom:20px}
header h1{font-size:34px;color:var(--wood);margin-bottom:6px}
header .subtitle{color:var(--muted);font-size:13px}

/* search + categories */
#search-section{display:flex;flex-direction:column;align-items:center;gap:12px;margin-bottom:18px}
#searchInput{
  width:92%;max-width:540px;padding:10px 14px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);font-size:15px;
  background: #fffefb;
  box-shadow: inset 0 2px 6px rgba(0,0,0,0.03);
}
#categoryButtons{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
.cat-btn{
  background: #f6e9d0; border:1px solid rgba(0,0,0,0.04);
  padding:8px 12px;border-radius:999px;color:var(--muted);cursor:pointer;font-weight:600;
}
.cat-btn.active{ background: var(--accent); color:white; box-shadow:0 6px 18px rgba(0,0,0,0.08) }

/* grid –∫–∞—Ä—Ç–æ—á–µ–∫ */
.casino-grid{
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap:18px;
  margin-bottom:26px;
}

/* –∫–∞—Ä—Ç–æ—á–∫–∞ */
.casino-card{
  background:var(--card-bg);
  border-radius:12px;
  overflow:hidden;
  display:flex;flex-direction:column;
  border:1px solid rgba(0,0,0,0.03);
  box-shadow: 0 6px 18px var(--shadow);
  transition: transform .18s ease, box-shadow .18s ease;
}
.casino-card:hover{ transform: translateY(-6px); box-shadow:0 14px 30px rgba(0,0,0,0.12) }

.casino-card img{width:100%;height:150px;object-fit:cover;background:#efe6d6}
.casino-info{padding:14px;display:flex;flex-direction:column;gap:8px;flex:1}
.casino-info h3{margin:0;color:var(--wood);font-size:18px}
.casino-info p{margin:0;color:#6a5b4a;font-size:13px;min-height:36px}

/* –∫—É–ø–æ–Ω */
.promo{ background:var(--coupon); border-radius:10px; padding:8px 12px; text-align:center; cursor:pointer; border:1px dashed rgba(0,0,0,0.05); font-weight:700; font-family:monospace; color:var(--wood) }
.promo.copied{ background: #dfe8e3; color:#163a34; border-style:solid }

/* –∫–Ω–æ–ø–∫–∞ –≤ –∏–≥—Ä—É */
.play-button{
  margin:12px; padding:10px 12px; border-radius:10px; border:none; cursor:pointer; font-weight:800;
  background: linear-gradient(90deg,var(--accent), #6fa89a); color:#022a26;
  box-shadow: 0 10px 18px rgba(0,0,0,0.12);
}

/* scam special */
.casino-card.scam .play-button{ background: linear-gradient(90deg,#c85b5b,#e07a7a); color:white }

/* SCAM fall animation */
@keyframes scamFall {
  0% { transform: rotate(0) translateY(0); opacity:1 }
  60% { transform: rotate(10deg) translateY(80px); opacity:0.9 }
  100% { transform: rotate(60deg) translateY(900px); opacity:0 }
}
.casino-card.fall{ animation: scamFall 1.1s ease forwards }

/* –†–∞–Ω–¥–æ–º–∞–π–∑–µ—Ä (—Å–ª–æ—Ç) */
#randomizer-section{ text-align:center; margin:34px 0 }
.slot-container{ display:inline-block; background:#fffaf6; border:1px solid rgba(0,0,0,0.04); padding:18px; border-radius:12px; box-shadow:0 12px 30px rgba(0,0,0,0.08) }
.slot-display{ width:420px; max-width:86vw; height:72px; display:flex; align-items:center; justify-content:center; border-radius:10px; background:#fff7eb; border:1px solid rgba(0,0,0,0.03); overflow:hidden; margin-bottom:12px; position:relative }
.reel-list{ display:block; transform:translateY(0); will-change:transform }
.reel-item{ height:72px; line-height:72px; text-align:center; font-weight:800; color:var(--wood); border-bottom:1px dashed rgba(0,0,0,0.03); font-size:18px }
.slot-button{ padding:10px 18px; border-radius:10px; border:none; background:var(--accent); color:white; font-weight:800; cursor:pointer }

/* overlay result ‚Äî fixed so doesn't move layout */
#spin-result{ position:fixed; left:50%; top:14%; transform:translateX(-50%) scale(.98); padding:10px 14px; border-radius:10px; background:rgba(10,8,6,0.75); color:#fff; opacity:0; z-index:9999; pointer-events:none; transition:opacity .2s, transform .2s; font-weight:800 }

/* confetti canvas inside slot area absolute positioned */
#confettiCanvas{ position:absolute; left:50%; transform:translateX(-50%); top:0; width:420px; max-width:86vw; height:120px; pointer-events:none; }

/* modal bybit */
#bybit-instruction .modal{ max-width:520px; margin:18px auto; padding:16px; border-radius:12px; background:#fffaf2; border:1px solid rgba(0,0,0,0.04) }
.close-btn{ position:absolute; right:8px; top:6px; background:transparent; border:none; font-size:20px; cursor:pointer }

/* donate */
.donate-button{ display:inline-block; padding:10px 14px; border-radius:10px; background:#b07a46;color:#fff;text-decoration:none;font-weight:700 }

/* footer */
footer{ margin-top:36px; padding:26px 0; text-align:center; color:var(--muted); border-top:1px solid rgba(0,0,0,0.04) }

/* responsive */
@media (max-width:1100px){ .casino-grid{ grid-template-columns: repeat(3,1fr) } .slot-display{ height:64px } .reel-item{ height:64px; line-height:64px } }
@media (max-width:800px){ .casino-grid{ grid-template-columns: repeat(2,1fr) } }
@media (max-width:520px){ .casino-grid{ grid-template-columns: 1fr } #searchInput{ width:92% } #confettiCanvas{ width:90vw } }
</style>
</head>
<body>
  <!-- background trees (left/right canvases) -->
  <div id="forest-bg" aria-hidden="true">
    <canvas id="leftTree"></canvas>
    <canvas id="rightTree"></canvas>
  </div>

  <div class="container" role="main">
    <header>
      <h1>–ñ–µ–∫–∞ –¢–≤–∏–Ω–∫</h1>
      <div class="subtitle">–¢–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è –¥–µ–Ω—å –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫! –ü–æ–ø—ã—Ç–∞–π —É–¥–∞—á—É!</div>
    </header>

    <section id="search-section">
      <input id="searchInput" type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –ø—Ä–æ–º–æ–∫–æ–¥—É..." />
      <div id="categoryButtons" aria-hidden="false"></div>
    </section>

    <section id="casino-list" class="casino-grid" aria-live="polite"></section>

    <section id="randomizer-section">
      <h2>–ü–æ–ø—ã—Ç–∞–π —É–¥–∞—á—É!</h2>
      <div class="slot-container">
        <div id="slotWrap" style="position:relative;display:inline-block">
          <div id="slotDisplay" class="slot-display" aria-live="polite"></div>
          <canvas id="confettiCanvas"></canvas>
        </div>
        <div style="margin-top:12px">
          <button id="startRandomizer" class="slot-button">–ö—Ä—É—Ç–∏—Ç—å!</button>
        </div>
      </div>
    </section>

    <section id="bybit-instruction" class="hidden">
      <div class="modal">
        <button id="closeBybit" class="close-btn" title="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
        <h3>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è BYBIT</h3>
        <p>üí∏ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ Bybit –∏ –ø–æ–ª—É—á–∏—Ç–µ –±–æ–Ω—É—Å ‚Äî –¥–µ–º–æ.</p>
        <p>–ö–æ–¥: <b>WAAARLM</b></p>
      </div>
    </section>

    <section id="donate" style="text-align:center;margin-top:22px">
      <a class="donate-button" href="https://donatepay.ru/don/435213" target="_blank" rel="noopener">–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</a>
    </section>

    <footer>
      <p class="footer-text">–ù–µ –∏–≥—Ä–∞–π—Ç–µ, –æ–¥—É–º–∞–π—Ç–µ—Å—å, –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ—Å—å! –ù–æ –µ—Å–ª–∏ —è –≤–∞—Å –Ω–µ —É–±–µ–¥–∏–ª ‚Äî —Ö–æ—Ç—è –±—ã –Ω–∞–ø—Ä–∞–≤–ª—é –≤ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –º–µ—Å—Ç–∞.</p>
    </footer>
  </div>

  <div id="spin-result" aria-hidden="true">–ü–æ–∑–¥—Ä–∞–≤–ª—è—é!</div>

<script>
/* ================ –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–¥–µ–º–æ) ================ */
/* –®—É—Ç–æ—á–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (–ø–∞—Ä–æ–¥–∏–π–Ω—ã–µ) */
const CASINOS = [
  {name:"–í–∞–≤–∞–¥–∞", desc:"–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–µ –º–µ—Å—Ç–æ, –≥–¥–µ –ª–µ–≥–µ–Ω–¥—ã —Ç–æ–∂–µ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—é—Ç.", promo:"VAVADA777", categories:["–¢–æ–ø","–®—É—Ç–∫–∞"], img:"https://placehold.co/600x300?text=Vavada", url:"#"},
  {name:"–°—Ç–µ–π–∫", desc:"–°–æ—á–Ω—ã–π —Å–∞–π—Ç, –ø—Ä–æ–∂–∞—Ä–µ–Ω–Ω—ã–π –Ω–∞ 100% –Ω–µ—É–¥–∞—á–∏.", promo:"MEAT100", categories:["–¢–æ–ø"], img:"https://placehold.co/600x300?text=Stake", url:"#"},
  {name:"–í–æ–¥–∫–∞", desc:"–ü–µ–π, –∏–≥—Ä–∞–π, –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–π ‚Äî –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ!", promo:"SHOT2025", categories:["–®—É—Ç–∫–∞"], img:"https://placehold.co/600x300?text=Vodka", url:"#"},
  {name:"–ë—É–π", desc:"–ö–æ—Ä–∞–±–ª—å —Ñ–æ—Ä—Ç—É–Ω—ã, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ —É—Ç–æ–Ω—É–ª. –ù–æ –≤–µ—Å–µ–ª–æ!", promo:"BOOM1", categories:["–¢–æ–ø"], img:"https://placehold.co/600x300?text=Boooi", url:"#"},
  {name:"–ü–ª–µ–π–§–æ—Ä—Ç—É–Ω–∞", desc:"–§–æ—Ä—Ç—É–Ω–∞ –∏–≥—Ä–∞–µ—Ç, –Ω–æ –Ω–µ —Å —Ç–æ–±–æ–π.", promo:"FORT999", categories:["–ù–æ–≤—ã–µ"], img:"https://placehold.co/600x300?text=PlayFortuna", url:"#"},
  {name:"–î–∂–æ–π–ö–∞–∑–∏–Ω–æ", desc:"–†–∞–¥–æ—Å—Ç—å –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –∑–∞—Ö–æ–¥–∏—à—å –Ω–∞ —Å–∞–π—Ç.", promo:"JOY0", categories:["–¢–æ–ø"], img:"https://placehold.co/600x300?text=JoyCasino", url:"#"},
  {name:"–°–ö–ê–ú", desc:"–ù–∏–∫–∞–∫–æ–≥–æ —Å–∫–∞–º–∞! –¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –º–µ–º—ã!", promo:"", categories:["–§–µ–π–∫"], img:"https://placehold.co/600x300/ff6961/ffffff?text=SCAM", url:"#", fake:true}
];

/* –°–ø–∏—Å–∫–∏ —Å–ª–æ–≤ ‚Äî –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –±–æ–ª—å—à–∏–µ —Å–ø–∏—Å–∫–∏ –ø–æ–∑–∂–µ */
const GOOD_WORDS = [
  "–ü–µ–Ω—Ç—Ö–∞—É—Å –Ω–∞ –ú–∞–Ω—Ö—ç—Ç—Ç–µ–Ω–µ","–Ø—Ö—Ç–∞ –º–µ—á—Ç—ã","–°—É–Ω–¥—É–∫ —Å–æ–∫—Ä–æ–≤–∏—â","–ú–∏–ª–ª–∏–æ–Ω –¥–æ–ª–ª–∞—Ä–æ–≤",
  "Ferrari –≤ –ø–æ–¥–∞—Ä–æ–∫","–î–æ–º —É –æ–∫–µ–∞–Ω–∞","–ö–∞—Ä—Ç–∞ –±–µ–∑ –ª–∏–º–∏—Ç–∞","–í–∏–ª–ª–∞ –≤ –î—É–±–∞–µ",
  "–®–µ—Ñ-–ø–æ–≤–∞—Ä –Ω–∞ –≥–æ–¥","–ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π –∫–æ—Ñ–µ","–õ–∏—á–Ω—ã–π –≤–æ–¥–∏—Ç–µ–ª—å","–ü–∞–∫–µ—Ç –±–∏—Ç–∫–æ–∏–Ω–æ–≤",
  "–ì–æ—Ä–∞ –∑–æ–ª–æ—Ç–∞","–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –æ—Ç–ø—É—Å–∫","–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –æ—Å—Ç—Ä–æ–≤","–ü—Ä–∏–≤–∞—Ç–Ω—ã–π —Å–∞–º–æ–ª—ë—Ç",
  "–î–æ–º –Ω–∞ –∫–æ–ª–µ—Å–∞—Ö","Tesla Plaid","–ú–∏–ª–ª–∏–æ–Ω –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤","–ü—Ä–µ–º–∏—É–º –±–æ–Ω—É—Å",
  "–î–≤–æ—Ä–µ—Ü –≤ –≥–æ—Ä–∞—Ö","–ë—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–≤—ã–π –±—Ä–∞—Å–ª–µ—Ç","–®–∫–∞—Ñ –∫—Ä–æ—Å—Å–æ–≤–æ–∫","–ü—Ä–µ–º–∏—è –º–∏–ª–ª–∏–æ–Ω–µ—Ä–∞",
  "–ö–∞—Ä—Ç–∞ —É–¥–∞—á–∏","–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π —Ç—É—Ä","–ó–æ–ª–æ—Ç–∞—è –∫–Ω–æ–ø–∫–∞ YouTube","–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π Wi-Fi",
  "–ü–æ–¥–∞—Ä–æ—á–Ω–∞—è –∫–∞—Ä—Ç–∞","–†–∞–π—Å–∫–∏–π –æ—Ç–¥—ã—Ö","–ó–æ–ª–æ—Ç–æ–π —á–µ–º–æ–¥–∞–Ω—á–∏–∫","–®–∫–∞—Ñ –ø–æ–ª–æ–Ω –¥–µ–Ω–µ–≥",
  "–£–∂–∏–Ω —Å –ò–ª–æ–Ω –ú–∞—Å–∫–æ–º","–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –±—Ä–µ–Ω–¥","–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π —Å–µ–π—Ñ","–ú–∞–≥–Ω–∏—Ç —É–¥–∞—á–∏",
  "–õ–∏—á–Ω—ã–π –±–∞–Ω–∫–∏—Ä","–û–≥—Ä–æ–º–Ω–∞—è –ø–∞—á–∫–∞ –¥–µ–Ω–µ–≥","–ö–∞—Ä—Ç–∞ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏","–î–≤–æ—Ä–µ—Ü –ø–æ–¥ –∫–ª—é—á"
];

const BAD_WORDS = [
  "–ù–∏—á–µ–≥–æ","–ù–æ–ª—å","–û—à–∏–±–∫–∞","–ñ–∞–ª—å","–ü—Ä–æ–º–∞—Ö","–ú–∏–º–æ","–£–ø—Å","–ù–µ —Å—É–¥—å–±–∞",
  "–ü–µ—á–∞–ª—å","–°–æ—Ä–∏","–ü–ª–∞–∫-–ø–ª–∞–∫","–£–¥–∞—á–∞ —Å–±–µ–∂–∞–ª–∞","–ü–æ–ø—Ä–æ–±—É–π –∑–∞–≤—Ç—Ä–∞","–¢—ã —Å–µ—Ä—å—ë–∑–µ–Ω?",
  "404: –ø—Ä–∏–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω","–ü—à–∏–∫","–§–∏–∞—Å–∫–æ","–ù–µ—Ç-–Ω–µ—Ç","–õ–æ—Ç –Ω–µ –≤—ã–∏–≥—Ä–∞–Ω","–ú–∏–º–æ —Ü–µ–ª–∏",
  "–ù–µ —Ñ–∞—Ä—Ç–∞–Ω—É–ª–æ","–ü—Ä–æ–º–∞—Ö–Ω—É–ª—Å—è","–°–ª—É—á–∞–π –ø—Ä–æ–º–æ–ª—á–∞–ª","–ü–µ—á–∞–ª—å–Ω—ã–π –∏—Å—Ö–æ–¥","–ù–µ –≤ —ç—Ç–æ—Ç —Ä–∞–∑",
  "–ü—É—Å—Ç–æ –∫–∞–∫ –≤ –∫–∞—Ä–º–∞–Ω–µ","–£—à–ª–∞ —É–¥–∞—á–∞","–•–∞-—Ö–∞, –º–∏–º–æ","–û—à–∏–±–∫–∞ —Ñ–æ—Ä—Ç—É–Ω—ã","–û–ø-–ø–∞"
];

/* ================ DOM refs ================ */
const casinoList = document.getElementById('casino-list');
const searchInput = document.getElementById('searchInput');
const categoryButtons = document.getElementById('categoryButtons');

const slotDisplay = document.getElementById('slotDisplay');
const startBtn = document.getElementById('startRandomizer');
const slotWrap = document.getElementById('slotWrap');
const confettiCanvas = document.getElementById('confettiCanvas');
const overlay = document.getElementById('spin-result');

/* ================== Render casinos ================== */
function buildCategories() {
  const cats = new Set();
  CASINOS.forEach(c => (c.categories||[]).forEach(cat => cats.add(cat)));
  categoryButtons.innerHTML = '';
  const allBtn = document.createElement('button'); allBtn.className='cat-btn active'; allBtn.textContent='–í—Å–µ'; allBtn.dataset.cat='all'; categoryButtons.appendChild(allBtn);
  [...cats].forEach(cat=>{
    const b = document.createElement('button'); b.className='cat-btn'; b.textContent=cat; b.dataset.cat=cat; categoryButtons.appendChild(b);
  });
  categoryButtons.addEventListener('click', e=>{
    const btn = e.target.closest('button'); if(!btn) return;
    categoryButtons.querySelectorAll('button').forEach(x=>x.classList.remove('active'));
    btn.classList.add('active');
    applyFilters();
  });
}

function createCard(c){
  const card = document.createElement('div'); card.className='casino-card';
  if(c.fake) card.classList.add('scam');
  card.dataset.categories = (c.categories||[]).join(' ');
  card.innerHTML = `
    <img src="${c.img}" alt="${c.name}">
    <div class="casino-info">
      <h3>${c.name}</h3>
      <p>${c.desc}</p>
      ${c.promo ? `<div class="promo" data-code="${c.promo}">${c.promo}</div>` : `<div style="height:34px"></div>`}
      <button class="play-button">${c.name === '–°–ö–ê–ú' || c.fake ? '–≤ –∏–≥—Ä—É' : '–≤ –∏–≥—Ä—É'}</button>
    </div>
  `;
  // event handlers
  const promoEl = card.querySelector('.promo');
  if(promoEl){
    promoEl.addEventListener('click', async (ev)=>{
      const code = promoEl.dataset.code||promoEl.textContent;
      try { await navigator.clipboard.writeText(code); promoEl.classList.add('copied'); promoEl.textContent='–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ'; setTimeout(()=>{ promoEl.classList.remove('copied'); promoEl.textContent = code; }, 1200); } catch(e){}
      ev.stopPropagation();
    });
  }
  const btn = card.querySelector('.play-button');
  if(c.fake || c.name.toLowerCase().includes('—Å–∫–∞–º')){
    btn.addEventListener('click', ()=>{
      card.classList.add('fall');
      setTimeout(()=> card.remove(), 1100);
    });
  } else {
    btn.addEventListener('click', async ()=>{
      if (c.promo) { try { await navigator.clipboard.writeText(c.promo);} catch(e){} }
      if (c.url && c.url !== '#') window.open(c.url,'_blank','noopener');
    });
  }
  return card;
}

function renderCasinos(list = CASINOS){
  casinoList.innerHTML = '';
  list.forEach(c=> casinoList.appendChild(createCard(c)));
}

/* ================ Filters & Search ================ */
function variantsOf(q){
  q = (q||'').toLowerCase();
  if(!q) return [''];
  const map = {'–π':'q','—Ü':'w','—É':'e','–∫':'r','–µ':'t','–Ω':'y','–≥':'u','—à':'i','—â':'o','–∑':'p','—Ö':'[','—ä':']','—Ñ':'a','—ã':'s','–≤':'d','–∞':'f','–ø':'g','—Ä':'h','–æ':'j','–ª':'k','–¥':'l','–∂':';','—ç':"'",'—è':'z','—á':'x','—Å':'c','–º':'v','–∏':'b','—Ç':'n','—å':'m','–±':',','—é':'.'};
  const enToRu = Object.fromEntries(Object.entries(map).map(([k,v])=>[v,k]));
  const ruEn = q.split('').map(c=> map[c]||c).join('');
  const enRu = q.split('').map(c=> enToRu[c]||c).join('');
  return [q, ruEn, enRu];
}

function applyFilters(){
  const activeBtn = categoryButtons.querySelector('.active');
  const cat = activeBtn ? activeBtn.dataset.cat : 'all';
  const q = searchInput.value.trim().toLowerCase();
  const vars = variantsOf(q);
  Array.from(casinoList.children).forEach(card=>{
    const title = (card.querySelector('h3')||{}).textContent.toLowerCase();
    const desc = (card.querySelector('p')||{}).textContent.toLowerCase();
    const promo = (card.querySelector('.promo')||{}).dataset.code || '';
    const hay = (title + ' ' + desc + ' ' + promo).toLowerCase();
    const matchQ = !q || vars.some(v => v && hay.includes(v));
    const cats = (card.dataset.categories||'').toLowerCase().split(/\s+/);
    const matchCat = (cat==='all') || cats.includes(cat.toLowerCase());
    card.style.display = (matchQ && matchCat) ? 'block' : 'none';
  });
}

searchInput.addEventListener('input', applyFilters);

/* ================ Randomizer (slot scroll) ================ */
const SPIN_SOUND_SRC = ""; // –≤—Å—Ç–∞–≤—å —Å–≤–æ–π mp3 URL, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –∑–≤—É–∫
const WIN_SOUND_SRC = "";

let isSpinning = false;
const confCanvas = confettiCanvas;
let confCtx = null;
if(confCanvas){ confCanvas.width = confCanvas.offsetWidth || 420; confCanvas.height = 120; confCtx = confCanvas.getContext('2d'); }

function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]] } return arr; }

startBtn.addEventListener('click', async ()=>{
  if(isSpinning) return;
  isSpinning = true;
  // prepare audio (optional)
  const spinAudio = SPIN_SOUND_SRC ? new Audio(SPIN_SOUND_SRC) : null;
  const winAudio = WIN_SOUND_SRC ? new Audio(WIN_SOUND_SRC) : null;
  if(spinAudio){ spinAudio.loop = true; spinAudio.volume = 0.75; try{ await spinAudio.play(); }catch(e){} }

  // prepare sequence: several loops of goods + tail goods + final bad
  const loops = 6;
  const seq = [];
  for(let i=0;i<loops;i++){ seq.push(...shuffle([...GOOD_WORDS])); }
  // tail goods
  seq.push(...shuffle([...GOOD_WORDS]).slice(0,6));
  // final bad
  const finalBad = BAD_WORDS[Math.floor(Math.random()*BAD_WORDS.length)];
  seq.push(finalBad);

  // build DOM list
  slotDisplay.innerHTML = '';
  const list = document.createElement('div'); list.className='reel-list';
  seq.forEach(word=>{
    const it = document.createElement('div'); it.className='reel-item'; it.textContent = word; list.appendChild(it);
  });
  slotDisplay.appendChild(list);

  // measure heights
  await new Promise(r=>requestAnimationFrame(r));
  const item = list.querySelector('.reel-item');
  const itemH = item ? item.getBoundingClientRect().height : 72;
  const viewportH = slotDisplay.getBoundingClientRect().height;
  const targetIndex = seq.length - 1;
  const finalTranslate = -(itemH * targetIndex) + ((viewportH - itemH) / 2);

  // start from 0
  list.style.transition = 'none';
  list.style.transform = 'translateY(0px)';
  list.getBoundingClientRect();

  // animate (duration 5000ms, ease-out)
  const duration = 5000;
  list.style.transition = `transform ${duration}ms cubic-bezier(.16,.9,.07,1)`;
  list.style.transform = `translateY(${finalTranslate}px)`;

  // on end:
  list.addEventListener('transitionend', async function handler(){
    list.removeEventListener('transitionend', handler);
    // stop spin audio
    try{ if(spinAudio){ spinAudio.pause(); spinAudio.currentTime=0; } }catch(e){}
    // play win audio
    try{ if(winAudio){ winAudio.currentTime=0; await winAudio.play(); } }catch(e){}
    // highlight final item
    const last = list.querySelector('.reel-item:last-child');
    if(last){ last.style.color = '#a36d2d'; last.style.transform='scale(1.03)'; last.style.transition='transform .25s ease'; }
    // show overlay
    showOverlay("–ü–æ–∑–¥—Ä–∞–≤–ª—è—é!");
    // confetti burst
    launchConfetti(confCanvas, confCtx);
    setTimeout(()=>{ hideOverlay(); isSpinning=false; }, 1600);
  }, {once:true});
});

/* overlay control */
function showOverlay(text){
  overlay.textContent = text || '';
  overlay.style.opacity='1'; overlay.style.transform='translateX(-50%) scale(1.02)';
  overlay.setAttribute('aria-hidden','false');
}
function hideOverlay(){ overlay.style.opacity='0'; overlay.style.transform='translateX(-50%) scale(.98)'; overlay.setAttribute('aria-hidden','true'); }

/* ============== Confetti (burst) ============== */
function launchConfetti(canvas, ctx){
  if(!canvas || !ctx) return;
  const parts = [];
  const N = 80;
  for(let i=0;i<N;i++){
    parts.push({
      x: canvas.width/2 + (Math.random()-0.5)*240,
      y: 20 + Math.random()*40,
      vx: (Math.random()-0.5)*6,
      vy: Math.random()*6 + 2,
      r: Math.random()*5+2,
      color: `hsl(${Math.floor(Math.random()*360)},70%,55%)`
    });
  }
  const start = performance.now();
  function frame(now){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(const p of parts){
      p.x += p.vx; p.y += p.vy; p.vy += 0.12;
      ctx.beginPath(); ctx.fillStyle = p.color; ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
    }
    if(now - start < 2400) requestAnimationFrame(frame);
    else setTimeout(()=> ctx.clearRect(0,0,canvas.width,canvas.height), 80);
  }
  requestAnimationFrame(frame);
}

/* ============== Trees (grow 10s then stop) ============== */
function setupTree(canvasId, mirrored=false){
  const canvas = document.getElementById(canvasId);
  if(!canvas) return;
  // set pixel size
  const dpr = window.devicePixelRatio || 1;
  canvas.width = Math.floor(canvas.clientWidth * dpr);
  canvas.height = Math.floor(canvas.clientHeight * dpr);
  const ctx = canvas.getContext('2d');
  ctx.scale(dpr,dpr);

  // generate branches tree structure
  const branches = [];
  const baseX = mirrored ? canvas.clientWidth - 40 : 40;
  const baseY = canvas.clientHeight - 20;
  function grow(x,y,len,angle,depth){
    if(depth>6) return;
    const ex = x + len * Math.cos(angle);
    const ey = y - len * Math.sin(angle);
    branches.push({x,y,ex,ey,depth});
    const next = len * (0.68 + Math.random()*0.12);
    const spread = 0.28 + Math.random()*0.18;
    grow(ex,ey,next,angle+spread,depth+1);
    grow(ex,ey,next,angle-spread,depth+1);
  }
  grow(baseX,baseY,50,Math.PI/2,0);

  // animate drawing progressively for 10s
  const total = branches.length;
  const start = performance.now();
  const DURATION = 10000; // 10s
  function draw(now){
    ctx.clearRect(0,0,canvas.clientWidth,canvas.clientHeight);
    const t = Math.min((now - start) / DURATION,1);
    // easing: quick at start, slow at end (easeOutQuad)
    const prog = 1 - (1 - t) * (1 - t);
    ctx.lineCap = 'round';
    for(let i=0;i<branches.length;i++){
      const b = branches[i];
      const frac = i/total;
      if(frac <= prog){
        ctx.strokeStyle = '#6b4e2e';
        ctx.lineWidth = Math.max(6 - b.depth, 1);
        ctx.beginPath(); ctx.moveTo(b.x,b.y); ctx.lineTo(b.ex,b.ey); ctx.stroke();
        // add occasional coin on deep branches near end
        if(b.depth>4 && Math.random() < 0.06){
          ctx.beginPath(); ctx.fillStyle = '#f6c75a'; ctx.arc(b.ex,b.ey,4,0,Math.PI*2); ctx.fill();
        }
      }
    }
    if(t<1) requestAnimationFrame(draw);
    // else stop (tree stays)
  }
  requestAnimationFrame(draw);
}

/* ============== BYBIT toggle ============== */
document.getElementById('closeBybit').addEventListener('click', ()=> {
  document.getElementById('bybit-instruction').classList.add('hidden');
});

/* ============== Init ============== */
function init(){
  // render categories and cards
  buildCategories();
  renderCasinos();
  // initial focus on search
  setTimeout(()=> { try{ document.getElementById('searchInput').focus(); }catch(e){} },120);
  // tree animations
  setupTree('leftTree', false);
  setupTree('rightTree', true);
  // attach category/search hooks done in buildCategories/applyFilters
}
init();

/* small window resize handler to resize confetti canvas */
window.addEventListener('resize', ()=>{
  if(confettiCanvas){
    confettiCanvas.width = confettiCanvas.offsetWidth;
    confettiCanvas.height = 120;
  }
});
/* ============== END ============== */
</script>
</body>
</html>
